<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cotizador PROTAM</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="auth.js"></script>
  <script src="utils.js"></script>
  <script src="dataLoader.js"></script>
  <script src="cotizador.js"></script>
  <script src="storage.js"></script>
  <script src="pdfExporter.js"></script>
  <style>
    #cotizacionForm {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
      max-width: 300px;
    }
    #cotizacionForm input {
      width: 100%;
    }
  </style>
</head>
<body>
  <header>
    <h1>Cotizador PROTAM</h1>
    <button onclick="logout()">Cerrar Sesión</button>
  </header>
  <div class="container">
    <h2>Nueva Cotización</h2>
    <form id="cotizacionForm">
      <input type="text" id="nombreEmpresa" placeholder="Nombre" />
      <input type="text" id="empresa" placeholder="Empresa" />
      <input type="text" id="obra" placeholder="Obra" />
      <input type="text" id="direccion" placeholder="Dirección" />
      <input type="text" id="presupuesto" placeholder="Presupuesto" />
      <input type="text" id="version" placeholder="Versión" readonly />
      <input type="text" id="fechaCotizacion" placeholder="Fecha de Cotización" readonly />
      <input type="text" id="folio" placeholder="Folio" />
      <input type="text" id="supervisor" placeholder="Supervisor" />
    </form>
    <div>
      <button id="agregarProducto">+ Añadir Ítem</button>
      <button id="agregarSimilar">+ Añadir Similar</button>
      <button id="borrarSeleccion">Borrar Selección</button>
      <button id="guardarCotizacion">Guardar Cotización</button>
      <button id="exportarPDF">Exportar a PDF</button>
    </div>
    <div class="table-container">
      <table id="tablaResumen">
        <thead>
          <tr>
            <th>#</th><th>Nombre</th><th>Cantidad</th><th>Elemento</th><th>Alto (mm)</th><th>Ancho (mm)</th>
            <th>Vidrio A</th><th>Espesor A</th><th>Vidrio B</th><th>Espesor B</th><th>Separador</th>
            <th>Espesor Sep.</th><th>Color Sep.</th><th>Terminación</th><th>Perforación</th><th>Destajado</th>
            <th>m²</th><th>mL</th><th>Peso</th><th>Precio</th><th>Seleccionar</th>
          </tr>
        </thead>
        <tbody id="cuerpoTabla"></tbody>
      </table>
    </div>
    <div id="resumenCotizacion">
      <!-- Casilla Transporte y dirección -->
      <div>
        <input type="checkbox" id="servicioTransporte" />
        <label for="servicioTransporte"> Transporte</label>
        <input type="text" id="direccionTransporte" placeholder="Dirección de Transporte" style="display:none; margin-left:10px;" />
      </div>
      <p>Total Neto: $0</p>
      <p>IVA (19%): $0</p>
      <p>Total Final: $0</p>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Autocompletar fecha y versión
      const fechaInput = document.getElementById("fechaCotizacion");
      const versionInput = document.getElementById("version");
      if (fechaInput) {
        const hoy = new Date();
        fechaInput.value = hoy.toLocaleDateString();
      }
      if (versionInput) {
        const usuario = localStorage.getItem("usuario") || "default";
        const historial = JSON.parse(localStorage.getItem(`cotizaciones_${usuario}`) || "[]");
        versionInput.value = historial.length + 1;
      }
      // Mostrar/ocultar dirección transporte
      const chk = document.getElementById("servicioTransporte");
      const dir = document.getElementById("direccionTransporte");
      if (chk && dir) {
        chk.addEventListener("change", () => {
          dir.style.display = chk.checked ? "inline-block" : "none";
        });
      }
    });
  </script>
</body>
</html>
